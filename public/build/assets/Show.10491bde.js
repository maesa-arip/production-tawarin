import{u as v,r as i,e as b,d as N,j as c,a as e,H as S}from"./app.865dd7ba.js";import{A as T}from"./App.968f7bc5.js";import"./XIcon.7e965a4a.js";import"./clsx.m.256e9345.js";import"./transition.d46445bc.js";import"./Tawarin.08057ae7.js";const p=(t,r,o="justify")=>{if(o=="justify")return t===r?"justify-end":"justify-start";if(o=="background")return t===r?"bg-green-100 text-green-900":"bg-gray-100 text-gray-900"};function j(t){const{auth:r}=v().props,[o,l]=i.exports.useState(!1),n=i.exports.useRef(null),u=i.exports.useRef(null),{user:a,chats:d}=t,{data:m,setData:f,reset:g,errors:w,post:h}=b({message:""}),x=s=>{s.preventDefault(),h(route("chats.store",a.username),{onSuccess:()=>{g("message"),n.current.scrollTo(0,9999999)}})},y=()=>{setTimeout(()=>{Echo.private(`chats.${a.uuid}`).whisper("isTyping",{name:a.name})},500)};return Echo.private("chats."+r.user.uuid).listenForWhisper("isTyping",s=>{l(!0),setTimeout(()=>l(!1),5e3)}).listen("MessageSent",({chat:s})=>{N.Inertia.reload({preserveScroll:!0,onSuccess:()=>{n.current.scrollTo(0,9999999),l(!1)}})}),i.exports.useEffect(()=>{n.current.scrollTo(0,9999999),u.current.focus()},[]),c("div",{children:[e(S,{title:`Chat with ${a.name}`}),c("div",{className:"flex flex-col justify-between h-screen",children:[c("div",{className:"p-4 border-b",children:[e("h1",{className:"font-semibold",children:a.name}),o&&e("div",{className:"text-xs text-gray-500",children:"is typing . . ."})]}),e("div",{className:"flex-1 px-4 py-2 space-y-2 overflow-y-auto",ref:n,children:d.length?d.map(s=>e("div",{className:`flex text-sm ${p(r.user.id,s.sender_id)}`,children:e("div",{className:`p-4 rounded-xl ${p(r.user.id,s.sender_id,"background")}`,children:s.message})},s.id)):e("div",{className:"text-gray-500",children:"Start chat with someone . . ."})}),e("div",{className:"px-4 py-2 border-t",children:e("form",{onSubmit:x,children:e("input",{onKeyUp:y,ref:u,value:m.message,autoComplete:"off",onChange:s=>f({...m,message:s.target.value}),type:"text",placeholder:"Start typing . . . ",name:"message",id:"message",className:"w-full p-0 border-0 form-text focus:outline-none focus:border-0 focus:ring-0"})})})]})]})}j.layout=t=>e(T,{children:t});export{j as default};
